language:
  - rust
  - node_js

sudo: false

cache: 
  - cargo
  - yarn

before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.22.4
  - export PATH="$HOME/.yarn/bin:$PATH"

before_script:
  - yarn install

jobs:
  script:
    - cargo test
    - webpack --version
    - yarn build
  
deploy:
  provider: s3
  bucket: life.jonstites.com  
  skip_cleanup: true
  local_dir: dist
  access_key_id: $AWS_ACCESS_KEY 
  secret_access_key: $AWS_SECRET_KEY
  region: $AWS_DEFAULT_REGION
  cache_control: "max-age=31536000"
  detect_encoding: true
  on:
    branch:
      - master
      - feature/bit_and_growable_hash
    
notifications:
  email:
    on_success: never